var contact_index_controller = {
    initialize: function () {
        var e = this;
        $(".add_ico").removeClass("hide"), e.select_address($(".contact_box >div")), e.go_new($(".add_ico")), $("#nav").addClass("hide")
    }, select_address: function (e) {
        $(e).bind(itap_event, function () {
            var e = $(this);
            $(".clear_fix.push").removeClass("push"), e.addClass("push"), setTimeout(function () {
                var t = e.data("href"), a = md5((new Date).getTime().toString());
                t = t.indexOf("?from") > -1 ? t + "&" + a : t + "?" + a, window.location.href = t, e.removeClass("push")
            }, 200)
        })
    }, auto_address: function () {
        var e = $("#name"), t = $("#phone"), a = $("#province_select"), n = $("#city_select"), i = $("#area_select"), r = $(".address_txt"), o = $("#zipcode");
        $idcard = $("#idcard"), contact_new_controller.initialize($("#address"), e, t, r, a, n, i, o, $idcard)
    }, go_new: function (e) {
        $(e).bind(itap_event, function () {
            var e = $(this), t = $("#address_layer");
            e.addClass("push"), t.removeClass("hide"), t.css("height", DeviceInfo.height), app.layer_appear(t), setTimeout(function () {
                e.removeClass("push")
            }, 200)
        })
    }
}, app = {
    reset_height: function () {
        var e = 51;
        1 === $(".bottom_fix").length && (e = 100), $(window).resize(function () {
            $("#main").css("height", window.innerHeight - e), $("body, .pay_layer, .nav_layer, .success_order_layer, .fail_order_layer").css("height", window.innerHeight)
        })
    },
    scroll: function () {
        var e = $("#main");
        0 != e.length && (this.iscroll = new IScroll(e[0], {
            scrollX: !1,
            scrollY: !0,
            momentum: !0,
            scrollbars: !0,
            fadeScrollbars: !0,
            shrinkScrollbars: "clip"
        }))
    },
    keyboard_event: function () {
        $("form").on("submit", function () {
            var e = document.createElement("input");
            e.setAttribute("type", "text"), document.body.appendChild(e), setTimeout(function () {
                e.focus(), setTimeout(function () {
                    e.setAttribute("style", "display:none;")
                }, 50)
            }, 50)
        })
    },
    get_user: function () {
        var e = document.cookie.split(";"), t = !1;
        for (var a in e)e[a].indexOf("user_id") > -1 && "" != e[a].trim().split("=")[1] && e[a].trim().split("=")[1] > 0 && (t = !0);
        return t
    },
    authorize_login: function (e, t) {
        var a = encodeURIComponent(window.location.origin + "/loading?path=" + t);
        user.get_wechat(function (e) {
            e && (window.location.href = e.url)
        }, e, "default", a)
    },
    clear_cookie: function (e) {
        var t = new Date;
        t.setTime(t.getTime() - 1e4), document.cookie = e + "=; expires=" + t.toGMTString() + "; path=/"
    },
    handle_cookie: function (e, t) {
        document.cookie = e + "=" + t + ";path=/"
    },
    _lasy_load: function (e, t) {
        var a = $(e), n = a.parent(), i = a.data("src"), r = new Image;
        a[0] && (n.hasClass("loaded") || "" === i || ($(r).bind("load", function () {
            a.attr("src", i), n.addClass("loaded"), t && t(!0)
        }).bind("error", function () {
            a.complete && (n.addClass("failed"), t && t(!1))
        }), r.src = i))
    },
    lasy_load: function (e) {
        for (var t = 0; t < $(e).length; t++)this._lasy_load($(e)[t])
    },
    on_off_event: function (e, t, a, n) {
        $(e).bind(itap_event, function (e) {
            e.preventDefault(), e.stopPropagation(), -1 != document.referrer.indexOf(window.location.host) && $(".back_ico").toggleClass("hide");
            var t = $(this);
            t.toggleClass("active push"), setTimeout(function () {
                t.toggleClass("edit"), t.removeClass("push")
            }, 200), t.hasClass("edit") ? (a.addClass("hide"), window.location.pathname.match(/carts/) && (t.hasClass("edit push") && $(".delete_pro").html("\u5df2\u9009\u5b9a0\u4ef6\u5546\u54c1"), n.removeClass("edit"))) : (a.removeClass("hide"), $(".bag_cancel").removeClass("active"), window.location.pathname.match(/carts/) && n.addClass("edit"))
        })
    },
    stop_link: function (e) {
        $(e).bind(itap_event, function (e) {
            e.preventDefault(), e.stopPropagation()
        })
    },
    layer: function (e) {
        e.unbind().bind("click touchstart", function (e) {
            e.preventDefault()
        })
    },
    close_app: function (e) {
        var t = this;
        $(e).bind(itap_event, function () {
            var e = $(this);
            e.addClass("push"), t.handle_cookie("app", "true"), $("#app").addClass("hide")
        })
    },
    layer_appear: function (e) {
        app.iscroll.disable(), setTimeout(function () {
            e.css("height", DeviceInfo.height).addClass("appear")
        }, 100)
    },
    layer_disappear: function (e) {
        app.iscroll.enable(), e.css("height", DeviceInfo.height).removeClass("appear")
    },
    push_event: function (e, t) {
        var a = this;
        $(e).bind(itap_event, function () {
            var e = $(this);
            e.hasClass("push") || (e.addClass("push"), "true" != get_cookie("app") && a.handle_cookie("app", "true"), 0 != $("input").length && $.each($("input"), function (e, t) {
                $(t).blur()
            }), setTimeout(function () {
                e.removeClass("push"), e.data("href") && "" != e.data("href") && (e.hasClass("success_back") && "true" == get_cookie("ulife_app") ? window.UAPPJSBridge ? UAPPJSBridge.goto_ushop_page() : $(document).on("UAPPJSBridgeReady", function () {
                    UAPPJSBridge.goto_ushop_page()
                }) : window.location.href = e.data("href"))
            }, t))
        })
    },
    app_download: function (e) {
        var t = navigator.userAgent.toLowerCase(), a = this;
        $(e).bind(itap_event, function () {
            var e = $(this);
            if (!e.hasClass("push")) {
                if ("micromessenger" == t.match(/MicroMessenger/i) && e.hasClass("client_download"))return void $("#wechat_app_tip").removeClass("hide");
                setTimeout(function () {
                    e.removeClass("push"), window.location.href = e.data("href")
                }, 200), "true" != get_cookie("app") && a.handle_cookie("app", "true")
            }
        })
    },
    close_tip_layer: function (e) {
        $(e).bind(itap_event, function () {
            $(this).addClass("hide")
        })
    },
    pic: function (e, t, a) {
        if (!e)return "";
        var n = [40, 50, 65, 80, 90, 110, 130, 145, 160, 180, 220, 225, 290, 300, 320, 350, 450, 640, 750, 1e3];
        t = this.close_size(t, n);
        var i = "", r = (e.split(".")[1] || "jpg").toLowerCase();
        t && (a || (a = "major"), this.size_table[t] && this.size_table[t][a] && (i = this.size_table[t][a]));
        var o = e + i;
        return o
    },
    slide: function (e, t) {
        var a = [240, 300, 320, 460, 480, 540, 600, 640, 720, 800];
        return t = this.close_size(t, a), result = "", t && (result = e + this.suffix_hash[t]), result
    },
    size_table: {
        40: {major: "Â -thumb220", large: "-thumb220"},
        50: {large: "-thumb220"},
        65: {major: "-thumb220"},
        80: {major: "-thumb220", large: "-thumb220"},
        90: {major: "-thumb220", large: "-thumb220"},
        110: {major: "-thumb220", large: "-thumb220"},
        130: {major: "-thumb220", large: "-thumb220"},
        145: {major: "-thumb220", large: "-thumb220"},
        160: {major: "-thumb220", large: "-thumb220"},
        180: {major: "-thumb220"},
        220: {major: "-thumb220", large: "-thumb220"},
        225: {major: "-thumb220", large: "-thumb220"},
        290: {major: "-thumb220", large: "-thumb220"},
        300: {major: "-thumb220", large: "-thumb220"},
        "320*175": {major: "m320x175", large: "m320x175"},
        350: {major: "-thumb220", large: "-thumb220"},
        450: {large: "-thumb220", major: "-thumb220"},
        640: {major: "-m640", large: "-m640"},
        750: {major: "-m640", large: "-m640"}
    },
    suffix_hash: {
        240: ".t240.jpg",
        320: ".t320.jpg",
        460: ".t460.jpg",
        480: ".t480.jpg",
        540: ".t540.jpg",
        640: ".t640.jpg",
        720: ".t720.jpg",
        800: ".t800.jpg",
        300: ".m300.jpg",
        600: ".m600.jpg"
    },
    close_size: function (e, t) {
        e = parseInt(e);
        for (var a in t) {
            if (t[a] == e)return e;
            if (t[a] > e)return t[a]
        }
        return e
    },
    rand: function (e) {
        return Math.floor(Math.random() * e)
    },
    generate_cdn: function (e) {
        var t = CONFIG.cdn_host, a = t.length;
        try {
            var n = e.length;
            return t[(parseInt(e.substring(n - 5, n - 4), 16) || 0) % a]
        } catch (i) {
            return t[this.rand(a)]
        }
    }
}, home_controller = {
    initialize: function () {
        if ($("#main").append('<input type="hidden" id="page" data-page="home">'), $(".search_ico").removeClass("hide"), $(".turn_points li:first-child").addClass("active"), -1 != window.location.href.indexOf("ref=")) {
            var e = window.location.search.replace(/\?ref=/, "");
            app.get_user() ? window.location.href = e : ($("#login_layer, #login_register_layer").removeClass("hide"), app.layer_appear($("#login_register_layer")))
        }
        setTimeout(function () {
            $.each($(".home_turn img"), function (e, t) {
                var a = $(t), n = a.data("src");
                if (-1 != n.indexOf("utilities/dynamic_pic")) {
                    n = app.slide(n.split("=")[1], DeviceInfo.width * get_cookie("ratio"));
                    var i = document.createElement("img");
                    $(i).bind("load", function () {
                        a[0].src = i.src
                    }).bind("error", function () {
                    }), i.src = n
                }
            }), $.each($(".home_new img"), function (e, t) {
                var a = $(t), n = a.data("small-src"), i = a.attr("src");
                if (1 != get_cookie("ratio") && (n = a.data("big-src")), !i || i != n) {
                    var r = document.createElement("img");
                    $(r).bind("load", function () {
                        a[0].src = r.src
                    }).bind("error", function () {
                    }), r.src = n
                }
            })
        }, 200)
    }, slide: function (e, t, a) {
        function n() {
            i && clearInterval(i);
            var e = r.find("a").length;
            i = setInterval(function () {
                if ($(".home_turn a:first-child").hasClass("loaded") || $(".home_turn a:first-child").hasClass("failed")) {
                    var t = scroll.currentPage.pageX + 1;
                    ($(".home_turn a:nth-child(" + t + ")").hasClass("loaded") || $(".home_turn a:nth-child(" + t + ")").hasClass("failed")) && scroll.goToPage(t % e, 0, 500)
                }
            }, 5e3)
        }

        var i, r = $(e), o = $(t), s = $(a), c = "landscape", l = this;
        scroll = new IScroll(r[0], {
            scrollX: !0,
            scrollY: !1,
            momentum: !1,
            snap: !0
        }), scroll.on("beforeScrollStart", function () {
        }), scroll.on("scrollEnd", function () {
            l.indicator_update(o, scroll.currentPage.pageX + 1)
        }), n(), this.handle_option(s, c), r.unbind("touchstart").bind("touchstart", function () {
            i && clearInterval(i)
        }).unbind("touchmove").bind("touchmove", function () {
            i && clearInterval(i)
        }).unbind("touchend").bind("touchend", function () {
            i && clearInterval(i), n()
        })
    }, indicator_update: function (e, t) {
        var a = $(e);
        a.children(".active").removeClass("active"), a.find("li:nth-child(" + t + ")").addClass("active")
    }, handle_option: function (e, t) {
        var a = $(e);
        a.bind("touchstart", function (e) {
            var n = e.touches[0], i = n.pageX, r = n.pageY;
            a.bind("touchmove", function (e) {
                var n = e.touches[0], o = n.pageX, s = n.pageY;
                t = Math.abs(o - i) < Math.abs(s - r) ? "portrait" : "landscape", a.unbind("touchmove")
            })
        })
    }
};
/*!
 * Joseph Myer's md5() algorithm wrapped in a self-invoked function to prevent
 * global namespace polution, modified to hash unicode characters as UTF-8.
 *
 * Copyright 1999-2010, Joseph Myers, Paul Johnston, Greg Holt, Will Bond <will@wbond.net>
 * http://www.myersdaily.org/joseph/javascript/md5-text.html
 * http://pajhome.org.uk/crypt/md5
 *
 * Released under the BSD license
 * http://www.opensource.org/licenses/bsd-license
 */
!function () {
    function e(e, t) {
        var o = e[0], s = e[1], c = e[2], l = e[3];
        o = a(o, s, c, l, t[0], 7, -680876936), l = a(l, o, s, c, t[1], 12, -389564586), c = a(c, l, o, s, t[2], 17, 606105819), s = a(s, c, l, o, t[3], 22, -1044525330), o = a(o, s, c, l, t[4], 7, -176418897), l = a(l, o, s, c, t[5], 12, 1200080426), c = a(c, l, o, s, t[6], 17, -1473231341), s = a(s, c, l, o, t[7], 22, -45705983), o = a(o, s, c, l, t[8], 7, 1770035416), l = a(l, o, s, c, t[9], 12, -1958414417), c = a(c, l, o, s, t[10], 17, -42063), s = a(s, c, l, o, t[11], 22, -1990404162), o = a(o, s, c, l, t[12], 7, 1804603682), l = a(l, o, s, c, t[13], 12, -40341101), c = a(c, l, o, s, t[14], 17, -1502002290), s = a(s, c, l, o, t[15], 22, 1236535329), o = n(o, s, c, l, t[1], 5, -165796510), l = n(l, o, s, c, t[6], 9, -1069501632), c = n(c, l, o, s, t[11], 14, 643717713), s = n(s, c, l, o, t[0], 20, -373897302), o = n(o, s, c, l, t[5], 5, -701558691), l = n(l, o, s, c, t[10], 9, 38016083), c = n(c, l, o, s, t[15], 14, -660478335), s = n(s, c, l, o, t[4], 20, -405537848), o = n(o, s, c, l, t[9], 5, 568446438), l = n(l, o, s, c, t[14], 9, -1019803690), c = n(c, l, o, s, t[3], 14, -187363961), s = n(s, c, l, o, t[8], 20, 1163531501), o = n(o, s, c, l, t[13], 5, -1444681467), l = n(l, o, s, c, t[2], 9, -51403784), c = n(c, l, o, s, t[7], 14, 1735328473), s = n(s, c, l, o, t[12], 20, -1926607734), o = i(o, s, c, l, t[5], 4, -378558), l = i(l, o, s, c, t[8], 11, -2022574463), c = i(c, l, o, s, t[11], 16, 1839030562), s = i(s, c, l, o, t[14], 23, -35309556), o = i(o, s, c, l, t[1], 4, -1530992060), l = i(l, o, s, c, t[4], 11, 1272893353), c = i(c, l, o, s, t[7], 16, -155497632), s = i(s, c, l, o, t[10], 23, -1094730640), o = i(o, s, c, l, t[13], 4, 681279174), l = i(l, o, s, c, t[0], 11, -358537222), c = i(c, l, o, s, t[3], 16, -722521979), s = i(s, c, l, o, t[6], 23, 76029189), o = i(o, s, c, l, t[9], 4, -640364487), l = i(l, o, s, c, t[12], 11, -421815835), c = i(c, l, o, s, t[15], 16, 530742520), s = i(s, c, l, o, t[2], 23, -995338651), o = r(o, s, c, l, t[0], 6, -198630844), l = r(l, o, s, c, t[7], 10, 1126891415), c = r(c, l, o, s, t[14], 15, -1416354905), s = r(s, c, l, o, t[5], 21, -57434055), o = r(o, s, c, l, t[12], 6, 1700485571), l = r(l, o, s, c, t[3], 10, -1894986606), c = r(c, l, o, s, t[10], 15, -1051523), s = r(s, c, l, o, t[1], 21, -2054922799), o = r(o, s, c, l, t[8], 6, 1873313359), l = r(l, o, s, c, t[15], 10, -30611744), c = r(c, l, o, s, t[6], 15, -1560198380), s = r(s, c, l, o, t[13], 21, 1309151649), o = r(o, s, c, l, t[4], 6, -145523070), l = r(l, o, s, c, t[11], 10, -1120210379), c = r(c, l, o, s, t[2], 15, 718787259), s = r(s, c, l, o, t[9], 21, -343485551), e[0] = d(o, e[0]), e[1] = d(s, e[1]), e[2] = d(c, e[2]), e[3] = d(l, e[3])
    }

    function t(e, t, a, n, i, r) {
        return t = d(d(t, e), d(n, r)), d(t << i | t >>> 32 - i, a)
    }

    function a(e, a, n, i, r, o, s) {
        return t(a & n | ~a & i, e, a, r, o, s)
    }

    function n(e, a, n, i, r, o, s) {
        return t(a & i | n & ~i, e, a, r, o, s)
    }

    function i(e, a, n, i, r, o, s) {
        return t(a ^ n ^ i, e, a, r, o, s)
    }

    function r(e, a, n, i, r, o, s) {
        return t(n ^ (a | ~i), e, a, r, o, s)
    }

    function o(t) {
        /[\x80-\xFF]/.test(t) && (t = unescape(encodeURI(t))), txt = "";
        var a, n = t.length, i = [1732584193, -271733879, -1732584194, 271733878];
        for (a = 64; a <= t.length; a += 64)e(i, s(t.substring(a - 64, a)));
        t = t.substring(a - 64);
        var r = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        for (a = 0; a < t.length; a++)r[a >> 2] |= t.charCodeAt(a) << (a % 4 << 3);
        if (r[a >> 2] |= 128 << (a % 4 << 3), a > 55)for (e(i, r), a = 0; 16 > a; a++)r[a] = 0;
        return r[14] = 8 * n, e(i, r), i
    }

    function s(e) {
        var t, a = [];
        for (t = 0; 64 > t; t += 4)a[t >> 2] = e.charCodeAt(t) + (e.charCodeAt(t + 1) << 8) + (e.charCodeAt(t + 2) << 16) + (e.charCodeAt(t + 3) << 24);
        return a
    }

    function c(e) {
        for (var t = "", a = 0; 4 > a; a++)t += u[e >> 8 * a + 4 & 15] + u[e >> 8 * a & 15];
        return t
    }

    function l(e) {
        for (var t = 0; t < e.length; t++)e[t] = c(e[t]);
        return e.join("")
    }

    function d(e, t) {
        return e + t & 4294967295
    }

    function d(e, t) {
        var a = (65535 & e) + (65535 & t), n = (e >> 16) + (t >> 16) + (a >> 16);
        return n << 16 | 65535 & a
    }

    var u = "0123456789abcdef".split("");
    md5 = function (e) {
        return l(o(e))
    }, "5d41402abc4b2a76b9719d911017c592" != md5("hello")
}();
var loading = {
    initialize: function () {
        var e = this, t = window.location.search.replace(/\?path\=/, "");
        $("header, #nav").addClass("hide"), $(".requesting").css("height", DeviceInfo.height), get_cookie("Mark") && get_cookie("No") && $("#main").append('<input type="hidden" id="' + get_cookie("Mark") + '" data-id="' + get_cookie("No") + '">'), -1 != window.location.href.indexOf("?path=") ? user.set_cookie(function (a) {
            a && a.user_id ? user.get_current(function (n) {
                n && n.connection && (e.id = n.connection.id), cart.get_new(function (n) {
                    if (n && n.retail_carts) {
                        var i = n.retail_carts.length, r = !1;
                        1 == i && (r = !0), r || (t = t.replace(/trades\/new/, "carts")), e.show_binding(a.user_id, t, i, r)
                    } else e.show_binding(a.user_id, t, 0, !1)
                })
            }) : window.location.href = "/"
        }) : window.location.href = "/"
    }, show_binding: function (e, t, a, n) {
        var i = this;
        get_cookie("skip") ? login_register_controller.login_href(a, n) : i.if_has_email(e, function (e) {
            window.set_cookie("skip", !0, 365), e && !e.flag ? ($(".requesting").addClass("need"), i.btn_method(t)) : e && e.flag && login_register_controller.login_href(a, n)
        })
    }, btn_method: function (e) {
        var t = this;
        contact_new_controller.keyup_event($(".read_in.name input"), 20), contact_new_controller.keyup_event($(".read_in.psd input"), 20), $("#binding_form").submit(function (e) {
            e.preventDefault();
            var a = $("#binding_submit");
            a.hasClass("push") || (a.addClass("push"), $.each($("input"), function (e, t) {
                $(t).blur()
            }), setTimeout(function () {
                login_register_controller.login_check($("#binding_form"), $(".binding_btn"), t.id)
            }, 300))
        }), $("#binding_submit").unbind(itap_event).bind(itap_event, function (e) {
            e.preventDefault(), $("#binding_form").submit()
        }), $(".create_btn").unbind(itap_event).bind(itap_event, function (t) {
            t.preventDefault(), window.location.href = e
        })
    }, if_has_email: function (e, t) {
        user.get_account(e, function (e) {
            e && e.account ? e.account.has_email && e.account.has_password ? (app.handle_cookie("has_email", !0), t({flag: !0})) : ($(".requesting").addClass("need"), app.handle_cookie("has_email", !1), t({flag: !1})) : ($(".requesting").addClass("need"), t({flag: !1}))
        })
    }
}, login_register_controller = {
    initialize: function () {
        var e = this, t = $(".log_btn"), a = $(".reg_btn"), n = $("#login_layer"), i = $("#register_layer"), r = $(".turnoff_ico");
        e.login_event(t, n, i), e.register_event(a, n, i), e.close_event(r), contact_new_controller.keyup_event($(".read_in.name input"), 20), contact_new_controller.keyup_event($(".read_in.psd input"), 20), contact_new_controller.keyup_event($(".read_in.rpsd input"), 20), contact_new_controller.keyup_event($(".captcha_input"), 4), $("#login").submit(function (t) {
            t.preventDefault(), $.each($("input"), function (e, t) {
                $(t).blur()
            }), setTimeout(function () {
                e.login_check($("#login"), $(".login_btn"))
            }, 300)
        }), $("#login_submit").unbind(itap_event).bind(itap_event, function (e) {
            e.preventDefault(), $("#login").submit()
        });
        var o = !1, s = !0, c = !1, l = null;
        e.password_blur(), e.email_blur(l, o, s, function (e) {
            l = e.flag, o = e.username_valid, s = e.captcha_valid
        }), e.captcha_blur(c, s, function (e) {
            c = e.captcha_validing, s = e.captcha_valid
        }), e.name_blur(), $("#register").submit(function (t) {
            t.preventDefault(), $.each($("input"), function (e, t) {
                $(t).blur()
            }), setTimeout(function () {
                e.register_check(o, l, c, s)
            }, 300)
        }), $("#register_submit").unbind(itap_event).bind(itap_event, function (e) {
            e.preventDefault(), $("#register").submit()
        });
        var d = $("#login_register_layer .clear_txt, #page_layer .clear_txt"), u = $("#login_register_layer input, #page_layer input");
        e.input_event(u), e.clear_text(d)
    }, input_event: function (e) {
        var t = this;
        $.each($(".email.read_in input"), function (e, a) {
            $(a).bind("input", function () {
                var e = $(this), a = e.val().indexOf("@"), n = $(".suffix_tip");
                if (-1 !== a) {
                    var i = e.val().slice(a + 1), r = t.get_email_suffix(i);
                    if (r.length > 0) {
                        for (var o = "", s = 0; s < r.length; s++)o += '<span class="left">' + r[s] + "</span>";
                        o = '<div class="tip_angle"></div>' + o + '<div class="clear"></div>', n.removeClass("hide").html(o), t.read_in(e, $(".suffix_tip span"), n)
                    } else n.addClass("hide")
                } else n.addClass("hide")
            })
        }), e.bind("input", function () {
            $(this).parent().find(".clear_txt").removeClass("hide")
        }), e.bind("blur", function () {
            $("#login_register_layer, #account_set_layer").css("position", "fixed"), $(this).parent().find(".clear_txt").addClass("hide"), $(".suffix_tip").addClass("hide")
        }), e.bind("focus", function () {
            (!$(this).hasClass("captcha_input") && "register" == $(this).parent().parent("form")[0].id || $(this).hasClass("captcha_input") || "manage_binding_form" == $(this).parent().parent("form")[0].id) && ($("#login_register_layer, #account_set_layer").css("position", "relative"), $("#main, header").addClass("hide")), $(this).parent().find(".clear_txt").toggleClass("hide", "" == $(this).val()), $(this).parent().find(".right_ico").addClass("hide")
        })
    }, get_email_suffix: function (e) {
        for (var t = ["sina.com", "163.com", "qq.com", "126.com", "hotmail.com", "yahoo.com", "gmail.com", "sohu.com", "yahoo.com.cn", "yahoo.cn", "live.com", "sina.cn", "vip.sina.com", "vip.sohu.com", "tom.com", "yeah.net", "21cn.com", "139.com", "weimall.net"], a = 0, n = [], i = 0; i < t.length && (("" == e || 0 == t[i].indexOf(e) && e !== t[i]) && (n.push(t[i]), a++), 6 != a); i++);
        return n
    }, read_in: function (e, t, a) {
        $(t).bind(itap_event, function () {
            var t = $(this), n = e.val(), i = t.text();
            e.val(n.slice(0, n.indexOf("@") + 1) + i), a.addClass("hide")
        })
    }, clear_text: function (e) {
        e.bind(itap_event, function () {
            $(this).parent().find("input").val(""), $(this).addClass("hide")
        })
    }, login_event: function (e, t, a) {
        e.bind(itap_event, function () {
            {
                var e = $(this);
                $("#login_register_layer .clear_txt"), $("#login_register_layer input")
            }
            $(".register_btn").hasClass("push") || (e.addClass("push"), $("input").val(""), $.each($("input"), function (e, t) {
                $(t).blur()
            }), $(".clear_txt").addClass("hide"), setTimeout(function () {
                e.removeClass("push"), t.removeClass("hide"), a.addClass("hide")
            }, 100))
        })
    }, register_event: function (e, t, a) {
        e.bind(itap_event, function () {
            {
                var e = $(this);
                $("#login_register_layer .clear_txt"), $("#login_register_layer input")
            }
            $em = $("#login_register_layer em.right_ico"), $(".login_btn").hasClass("push") || (e.addClass("push"), $("input").val(""), $.each($("input"), function (e, t) {
                $(t).blur()
            }), $("input").blur(), $em.addClass("hide"), $(".captcha_need").addClass("hide"), setTimeout(function () {
                e.removeClass("push"), a.removeClass("hide"), t.addClass("hide")
            }, 100))
        })
    }, close_event: function (e) {
        e.bind(itap_event, function (e) {
            e.preventDefault();
            var t = $(this), a = $("#login_register_layer, #address_layer, #account_set_layer");
            t.addClass("push"), $.each($("input"), function (e, t) {
                $(t).blur(), "zipcode" != $(t).attr("id") && $(t).val("")
            }), $("textarea").val(""), $(".captcha_need").addClass("hide"), "true" != get_cookie("favorite") && $(".collect_ico").removeClass("push"), "true" != get_cookie("fanship") && $(".collect_fav_ico").removeClass("push"), $("#main, header").removeClass("hide"), app.layer_disappear(a), setTimeout(function () {
                t.removeClass("push"), $("#login_layer, #register_layer, #address_layer, #login_register_layer, #account_set_layer, #manage_layer, #complete_layer").addClass("hide")
            }, 300), setTimeout(function () {
                $("#user, #favorite, #go_pay, #fanship").remove(), app.clear_cookie("favorite"), app.clear_cookie("fanship")
            }, 400)
        })
    }, error: function (e) {
        return alert(e), !1
    }, login_check: function (e, t, a) {
        var n = e.find("input[name=username]"), i = e.find("input[name=password]"), r = $.trim(n.val()), o = $.trim(i.val()), s = this;
        return r ? Fv.checker.email_phone(r) ? o ? o.length < 6 && o.length > 0 ? (t.removeClass("push"), s.error("\u5bc6\u7801\u683c\u5f0f\u9519\u8bef")) : void s.login(r, o, t, a) : (t.removeClass("push"), s.error("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a")) : (t.removeClass("push"), s.error("\u8d26\u53f7\u683c\u5f0f\u9519\u8bef")) : (t.removeClass("push"), s.error("\u8d26\u53f7\u4e0d\u80fd\u4e3a\u7a7a"))
    }, login: function (e, t, a, n) {
        var i = this;
        a.hasClass("push") ? a.attr("disabled", !0) : a.addClass("push"), user.login(e, t, function (e) {
            return e ? e.account && e.account.id > 0 ? void(($(a).hasClass("binding_btn") || $(a).hasClass("manage_binding_btn")) && n ? user.bind_account(n, function (e) {
                e && i.return_page()
            }) : i.return_page()) : (a.removeClass("push"), alert(e.error.message)) : (a.removeClass("push"), alert("\u7f51\u7edc\u9519\u8bef"))
        })
    }, register_check: function (e, t, a, n) {
        var i = $('input[name="account[email]"]'), r = $('input[name="user[name]"]'), o = $('input[name="account[password]"]'), s = $('input[name="account[password_confirmation]"]'), c = $('input[name="coupon[code]"]'), l = $("input[name=captcha]"), d = $.trim(i.val()), u = $.trim(r.val()), h = $.trim(o.val()), p = $.trim(s.val()), f = $.trim(c.val()), _ = $.trim(l.val()), v = $(".register_btn"), m = $(".captcha_need"), g = this;
        if (0 === d.length)return v.removeClass("push"), g.error("\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a!");
        if (!e) {
            if ("true" === i.data("checked"))return v.removeClass("push"), g.error("\u8be5\u90ae\u7bb1\u5df2\u6ce8\u518c\u4f18\u4f17\u7f51!");
            if ("false" === i.data("checked"))return v.removeClass("push"), g.error("\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e!")
        }
        if (0 === u.length)return r.blur(), v.removeClass("push"), g.error("\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a!");
        if (h.length < 6 || p.length < 6)return o.blur(), v.removeClass("push"), g.error("\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e6\u4f4d!");
        if (h.length > 20 || p.length > 20)return o.blur(), v.removeClass("push"), g.error("\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc720\u4f4d!");
        if (h !== p)return s.blur(), o.blur(), v.removeClass("push"), g.error("\u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4!");
        if (!m.hasClass("hide") && 0 == _.length)return v.removeClass("push"), g.error("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a!");
        if (a)l.one("captcha_complete", function () {
            return n ? void g.register(d, u, h, p, _, f, v) : (v.removeClass("push"), g.error("\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e!"))
        }); else {
            if (!n)return v.removeClass("push"), g.error("\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e!");
            g.register(d, u, h, p, _, f, v)
        }
    }, login_href: function (e, t) {
        var a = this, n = $("#user"), i = $("#favorite"), r = $("#fanship"), o = $("#go_pay");
        if (1 === n.length)return n.remove(), void(window.location.href = "/user_center");
        if (1 === r.length) {
            var s = r.data("id");
            return fanship.add(s, function (e) {
                e && e.fanship && $(".collect_fav_ico").addClass("push").data("id", e.fanship.id)
            }), r.remove(), app.handle_cookie("fanship", "true"), e && e > 0 && $(".nav_cart > div").html('<span class="sprites"></span><em>' + e + "</em>"), void a.close_event($(".turnoff_ico").trigger(itap_event))
        }
        if (1 === i.length) {
            var c = $(".product_img").data("id");
            return favorite.add(c, function (e) {
                e && e.favorite && $(".collect_ico").addClass("push").attr("data-id", e.favorite.id)
            }), i.remove(), app.handle_cookie("favorite", "true"), e && e > 0 && $(".nav_cart > div").html('<span class="sprites"></span><em>' + e + "</em>"), void a.close_event($(".turnoff_ico").trigger(itap_event))
        }
        return 1 == o.length || "go_pay" === get_cookie("Mark") ? (app.clear_cookie("go_pay"), o.remove(), setTimeout(function () {
            a.close_event($(".turnoff_ico").trigger(itap_event))
        }, 500), $(".page_layer").addClass("hide"), void(window.location.href = t ? "/trades/new" : "/carts")) : (-1 != window.location.href.indexOf("ref=") && ($(".page_layer").addClass("hide"), window.location.href = window.location.search.replace(/\?ref=/, "")), void(-1 != window.location.href.indexOf("path=") && (window.set_cookie("skip", !0, 365), window.location.href = window.location.search.replace(/\?path=/, ""))))
    }, cookie_num: function () {
        var e = [];
        return $.map(JSON.parse(decodeURIComponent(get_cookie("carts"))), function (t) {
            e.push(t)
        }), e.length
    }, return_page: function () {
        var e = this;
        user.set_cookie(function (t) {
            t.user_id && cart.get_new(function (t) {
                if (t && t.retail_carts) {
                    var a = t.retail_carts.length, n = !1;
                    1 == a && (n = !0), e.login_href(a, !1)
                } else e.login_href(0, !1)
            })
        })
    }, register: function (e, t, a, n, i, r, o) {
        var s = this;
        o.hasClass("push") ? o.attr("disabled", !0) : o.addClass("push"), user.register(e, t, a, n, i, r, function (e) {
            e && e.account && e.account.id > 0 ? (_gaq.push(["_trackEvent", "\u6ce8\u518c", "\u6ce8\u518c\u6210\u529f", e.account.id + ""]), setTimeout(function () {
                s.return_page()
            }, 1500)) : (o.removeClass("push"), alert("\u6ce8\u518c\u5931\u8d25, \u8bf7\u91cd\u65b0\u6ce8\u518c!"))
        })
    }, password_blur: function () {
        var e = $('input[name="account[password]"]'), t = $('input[name="account[password_confirmation]"]');
        e.blur(function () {
            var t = $.trim(e.val()), a = t.length;
            a > 5 && 21 > a ? e.next().removeClass("hide") : e.next().addClass("hide")
        }), t.blur(function () {
            var a = $.trim(e.val()), n = $.trim(t.val()), i = (a.length, n.length);
            i > 5 && 21 > i && a == n ? t.next().removeClass("hide") : t.next().addClass("hide")
        })
    }, email_blur: function (e, t, a, n) {
        var i = $('input[name="account[email]"]'), r = $(".captcha_need");
        i.blur(function () {
            var o = $.trim(i.val());
            i.next().addClass("hide"), t = !1, o && (Fv.checker.email_phone(o) ? user.need_captcha(o, function (s) {
                s && (s.account ? (i.data("checked", "true"), e = 1) : (e = null, i.data("checked", ""), t = !0, i.next().removeClass("hide"), /^1\d{10}$/.test(o) ? i.attr("name", "account[phone]") : i.attr("name", "account[email]"), s.need_captcha && (a = !1, user.get_captcha(function (e) {
                    r.removeClass("hide").find("img").attr("src", e)
                }))), n({flag: e, username_valid: t, captcha_valid: a}))
            }) : (i.data("checked", "false"), e = 0, i[0].blur(), n({flag: e, username_valid: t, captcha_valid: a})))
        })
    }, name_blur: function () {
        var e = $('input[name="user[name]"]');
        e.blur(function () {
            var t = $.trim(e.val());
            t.length > 0 ? e.next().removeClass("hide") : e.next().addClass("hide"), t.length > 20 && e.val(t.slice(0, 20))
        })
    }, captcha_blur: function (e, t, a) {
        var n = $("input[name=captcha]"), i = $(".captcha_need");
        n.blur(function () {
            var r = $(this), o = $.trim(r.val());
            return 4 !== o.length ? (t = !1, void i.children("em").addClass("hide")) : (e = !0, void user.valid_captcha(o, function (r) {
                r ? (t = !0, i.children("em").removeClass("hide")) : (t = !1, i.children("em").addClass("hide")), n.trigger("captcha_complete"), e = !1, a({
                    captcha_validing: e,
                    captcha_valid: t
                })
            }))
        })
    }
}, sidebar = {
    initialize: function (e, t, a, n, i, r) {
        var o = this;
        o.nav_event(e, t, a), o.close_layer(e, t, a, n), o.go_link(i, t, a, e), o.go_back(r), o.move_nav(e), $("header").unbind().bind("click touchstart", function (e) {
            e.preventDefault()
        })
    }, move_nav: function (e) {
        e.bind("touchstart", function (e) {
            e.preventDefault(), app.iscroll.disable()
        }).bind("touchmove", function (t) {
            t.preventDefault();
            var a = t.touches[0].pageX - 25, n = t.touches[0].pageY - 25;
            0 > a && (a = 0), a > DeviceInfo.width - 51 && (a = DeviceInfo.width - 51), 0 > n && (n = 0), n > DeviceInfo.height - 51 && (n = DeviceInfo.height - 51), e.css({
                left: a,
                top: n
            })
        }).bind("touchend", function (t) {
            var a = e.offset().left, n = e.offset().top;
            0 > a && (a = 0), a > DeviceInfo.width - 51 && (a = DeviceInfo.width - 51), 0 > n && (n = 0), n > DeviceInfo.height - 51 && (n = DeviceInfo.height - 51), app.handle_cookie("x", a), app.handle_cookie("y", n), t.preventDefault(), app.iscroll.enable()
        })
    }, go_back: function (e) {
        window.history.length > 1 && window.location.href != window.location.origin + "/" && document.referrer && $(e).removeClass("hide"), e.bind(itap_event, function () {
            e.addClass("push"), "true" != get_cookie("app") && app.handle_cookie("app", "true"), window.history.go(-1)
        })
    }, nav_event: function (e, t, a) {
        e.bind(itap_event, function () {
            e.addClass("push"), t.removeClass("hide");
            var n = DeviceInfo.height - 18;
            432 > n ? a.find(".nav_auto").css({height: n, "margin-top": -n / 2}) : a.bind("touchstart", function (e) {
                e.preventDefault()
            }), setTimeout(function () {
                a.addClass("appear"), e.removeClass("push").addClass("hide")
            }, 100)
        })
    }, close_layer: function (e, t, a, n) {
        n.bind("click touchstart", function () {
            e.removeClass("hide"), a.removeClass("appear"), t.addClass("hide")
        })
    }, go_link: function (e, t, a, n) {
        e.bind(itap_event, function () {
            var e = $(this), i = e.data("href");
            if (e.addClass("push"), i)setTimeout(function () {
                window.location.href = i, e.removeClass("push"), t.addClass("hide"), a.removeClass("appear"), n.removeClass("hide")
            }, 100); else if (app.get_user())e.removeClass("push"), n.removeClass("hide"), a.removeClass("appear"), window.location.href = "/user_center"; else {
                var r, o = navigator.userAgent.toLowerCase();
                "micromessenger" == o.match(/MicroMessenger/i) ? r = "wechat" : "aliapp" == o.match(/AliApp/i) && (r = "alipay"), r ? app.authorize_login(r, "/user_center") : (e.removeClass("push"), n.removeClass("hide"), t.addClass("hide"), a.removeClass("appear"), $("#login_layer, #login_register_layer").removeClass("hide"), app.layer_appear($("#login_register_layer")), $("#main").append('<input type="hidden" id="user">'))
            }
            "true" != get_cookie("app") && app.handle_cookie("app", "true")
        })
    }
}, contact_new_controller = {
    initialize: function (e, t, a, n, i, r, o, s, c) {
        function l() {
            13 == event.keyCode && (event.cancel = !0, event.preventDefault(), e.submit())
        }
        var d = $(i), u = this, h = "", p = "";
        u.close_layer($("#address_layer .turnoff_ico")), u.input_event($("#address_layer .read_in input, #address_layer .detail textarea")), u.clear_txt($(".clear_txt")), ip.get(function (e) {
            //if ((h = result.province_name, p = result.city_name), "" != h)for (var l = 0; l < d[0].length; l++)d[0][l].value == h && (d[0][l].selected = !0);
            u.keyup_event(t, 20), u.keyup_event(a, 11), u.keyup_event(s, 6), u.keyup_event(n, 60), u.keyup_event(c, 18), u.textarea_blur(n), u.textarea_focus(n), u.textarea_blur(s), u.textarea_focus(s), u.change_event(i, r, r, o, s, function () {
                var e = $(r), t = $(o), a = $(s);
                if (e[0].length > 1)for (var n = 0; n < e[0].length; n++)e[0][n].value == p && (e[0][n].selected = !0);
                u.fill_area_option(t, e.val()), u.fill_zipcode(a, e.val(), t.val())
            }), u.change_event(r, r, r, o, s, function () {
                var e = $(r), t = $(o), a = $(s);
                u.fill_zipcode(a, e.val(), t.val())
            }), u.change_event(o, null, r, o, s, function () {
            })
        }), $("textarea").bind("keyup", function () {
            l()
        }), $(".address_box input").bind("blur", function () {
            var e = $(this);
            e.next().addClass("hide"), $("#address_layer").css("position", "fixed")
        }), $("#address").submit(function (e) {
            e.preventDefault(), $.each($("input"), function (e, t) {
                $(t).blur()
            }), $.each($("textarea"), function (e, t) {
                $(t).blur()
            }), setTimeout(function () {
                u.check_info($("#address"), t, a, i, r, o, n, s, c) ? u.save_contacts() : $(".affirm").removeClass("push")
            }, 300)
        }), $(".affirm").unbind(itap_event).bind(itap_event, function (e) {
            e.preventDefault();
            var t = $(this);
            t.hasClass("push") || (t.addClass("push"), $("#address").submit())
        })
    }, save_contacts: function () {
        contacts.save($("#address").serialize(), function (e) {
            if (e.contact) {
                window.location.href.indexOf("from=ulife") > -1 && (t = "?from=ulife"), window.location.href.indexOf("from=hwg") > -1 && (t = "?from=hwg"), $(".affirm").removeClass("push"), window.location.href = "/contacts/" + e.contact.id
            }
        })
    }, clear_txt: function (e) {
        e.bind(itap_event, function () {
            $(this).prev().val(""), $(this).next().addClass("hide"), $(this).addClass("hide")
        })
    }, input_event: function (e) {
        e.bind("input", function () {
            var e = $(this), t = $.trim(e.val());
            e.next().hasClass("clear_txt") && e.next().toggleClass("hide", "" == t), "phone" == e.attr("id") ? e.parent().find("em.right_ico").toggleClass("hide", 11 != t.length || !Fv.checker.phone(t)) : "zipcode" == e.attr("id") ? e.parent().find("em").toggleClass("hide", !/^[0-9]{6}$/.exec(t)) : "idcard" == e.attr("id") ? e.parent().find("em").toggleClass("hide", !/^\w{18}$/.exec(t)) : e.parent().find("em").toggleClass("hide", "" == t)
        }), e.bind("focus", function () {
            var e = $(this), t = $.trim(e.val());
            e.next().hasClass("clear_txt") && e.next().toggleClass("hide", "" == t), $("#address_layer").css("position", "relative"), $("#main, header").addClass("hide")
        })
    }, close_layer: function (e) {
        e.bind(itap_event, function () {
            var e = $(this);
            $("input").blur(), $("textarea").blur(), $("#name,#phone,.address_txt,#idcard").parent(".read_in").find(".right_ico").addClass("hide"), $("#main, header").removeClass("hide"), e.addClass("push"), $("#address_layer").removeAttr("style"), app.layer_disappear($("#address_layer")), setTimeout(function () {
                e.removeClass("push")
            }, 300)
        })
    }, error: function (e) {
        return alert(e), !1
    }, render_option: function (e) {
        var t = "";
        return $(e).each(function (e, a) {
            t += a instanceof Object ? '<option value="' + a.name + '">' + a.name + "</option>" : '<option value="' + a + '">' + a + "</option>"
        }), t
    }, fill_city_option: function (e, t) {
        var a = ChinaArea.cities[t];
        $(e).html(this.render_option(a))
    }, fill_area_option: function (e, t) {
        var a = ChinaArea.areas[t];
        $(e).html(this.render_option(a))
    }, fill_zipcode: function (e, t, a) {
        var n = ChinaArea.areas[t];
        for (var i in n)if (n[i].name == a)return void($(e)[0].value = n[i].zipcode)
    }, keyup_event: function (e, t) {
        $(e).bind("keyup", function () {
            var e = $(this), a = $.trim(e.val());
            a.length > t && (e.val(a.slice(0, t)), e.siblings("em.right_ico").toggleClass("hide"))
        })
    }, textarea_blur: function (e) {
        $(e).bind("blur", function () {
            $(this)[0].scrollTop = 0, -1 != navigator.userAgent.toLowerCase().indexOf("ucbrowser") && -1 != navigator.userAgent.toLowerCase().indexOf("android") && ($("#address_layer").css("-webkit-transform", "translate(0px, 0px)"), $(".address_box").css("position", "relative").css("top", "0px"))
        })
    }, textarea_focus: function (e) {
        $(e).bind("focus", function () {
            -1 != navigator.userAgent.toLowerCase().indexOf("ucbrowser") && -1 != navigator.userAgent.toLowerCase().indexOf("android") && ($(".address_box").css("position", "absolute").css("top", "-170px").css("z-index", "4"), $("#address_layer").css("height", $("#address_layer").css("height") + 110 + "px"))
        })
    }, change_event: function (e, t, a, n, i, r) {
        var o = $(t), s = $(a), c = $(n), l = this;
        $(e).bind("change", function () {
            var t = $(this);
            "#province_select" == e.selector ? (l.fill_city_option(s, t.val()), r(o)) : "#city_select" == e.selector ? (l.fill_area_option(c, t.val()), r(o)) : "#area_select" == e.selector && l.fill_zipcode($("#zipcode"), s[0].value, t.val())
        }), $(e).trigger("change")
    }, check_info: function (e, t, a, n, i, r, o, s, c) {
        var l = this, d = $(t), u = $(a), h = $(n), p = $(i), f = $(r), _ = $(o), v = $(s);
        return $idcard = $(c), Fv.checker.min($.trim(d.val()), 1) ? Fv.checker.phone($.trim(u.val())) ? Fv.checker.min($.trim(h.val()), 1) ? Fv.checker.min($.trim(p.val()), 1) ? Fv.checker.min($.trim(f.val()), 1) ? Fv.checker.min($.trim(_.val()), 1) ? Fv.checker.zip($.trim(v.val())) ? $.trim($idcard.val()) && 18 != $.trim($idcard.val()).length ? l.error($idcard.data("msg")) : !0 : l.error(v.data("msg")) : l.error(_.data("msg")) : l.error(f.data("msg")) : l.error(p.data("msg")) : l.error(h.data("msg")) : l.error(u.data("msg")) : l.error(d.data("msg"))
    }
};
